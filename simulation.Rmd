---
title: "Simulation of Parameter Estimation of Dagum Distribution"
author: "Anjali Alex"
date: "2025-07-27"
output: html_document
---

### Required Libraries
```{r setup, message=FALSE, warning=FALSE}
library(fitdistrplus)
library(VGAM)
library(ggplot2)
library(dplyr)
library(tidyr)
library(brms)
library(reshape2)
options(mc.cores = parallel::detectCores())

```

### Define Dagum PDF and Sampling Function
```{r}
# Dagum PDF
ddagum <- function(x, a, b, p) {
  ifelse(x > 0,
         (a * p / b) * ((x / b)^(a * p)) / ((1 + (x / b)^a)^(p + 1)),
         1e-10)
}

# Dagum random number generator
rdagum <- function(n, a, b, p) {
  u <- runif(n)
  b * ((u^(-1/p) - 1)^(1/a))
}

```

### Adaptive Progressive Type II Censoring Function
```{r}
adaptive_prog_censor <- function(data, r, rule = "prop") {
  n <- length(data)
  sorted_data <- sort(data)
  failure_times <- sorted_data[1:r]
  R <- numeric(r)

  for (i in 1:r) {
    remaining <- n - i - sum(R[1:(i-1)])
    if (rule == "prop") {
      R[i] <- floor(remaining * 0.1)
    }
  }

  list(failure_times = failure_times, R = R)
}

```

### Custom Dagum Distribution for fitdist
```{r}
ddagumfit <- function(x, a, b, p, log = FALSE) {
  fx <- ifelse(x > 0 & a > 0 & b > 0 & p > 0,
               (a * p / b) * ((x / b)^(a * p)) / ((1 + (x / b)^a)^(p + 1)),
               1e-10)
  if (log) log(fx) else fx
}

pdagumfit <- function(q, a, b, p, lower.tail = TRUE, log.p = FALSE) {
  Fx <- ifelse(q > 0 & a > 0 & b > 0 & p > 0,
               (1 / (1 + (q / b)^(-a)))^p,
               0)
  if (!lower.tail) Fx <- 1 - Fx
  if (log.p) log(Fx) else Fx
}

```


### Frequentist Estimation (MLE)
```{r}
mle_dagum <- function(data) {
  fit <- fitdist(data, "ddagumfit", start = list(a = 2, b = 2, p = 2),
                 custom.den = ddagumfit)
  return(fit$estimate)
}

```

### Bayesian Estimation using Stan
```{r}
bayes_dagum <- function(data) {
  stan_data <- list(N = length(data), y = data)
  fit <- stan(file = "dagum_model.stan", data = stan_data,
              iter = 2000, chains = 2, refresh = 0)
  post <- extract(fit)
  c(mean(post$a), mean(post$b), mean(post$p))
}

```

### Simulation Study
```{r}
set.seed(123)

n_sim <- 50
n <- 500
true_params <- c(a = 2, b = 3, p = 1.5)

mle_estimates <- matrix(NA, n_sim, 3)
bayes_estimates <- matrix(NA, n_sim, 3)

for (i in 1:n_sim) {
  data <- rdagum(n, a = true_params[1], b = true_params[2], p = true_params[3])
  censored <- adaptive_prog_censor(data, r = 300)

  mle_estimates[i, ] <- tryCatch(
    mle_dagum(censored$failure_times), error = function(e) rep(NA, 3)
  )
  bayes_estimates[i, ] <- tryCatch(
    bayes_dagum(censored$failure_times), error = function(e) rep(NA, 3)
  )
}

```

### Bias and MSE Calculation
```{r}
bias_mle <- colMeans(mle_estimates, na.rm = TRUE) - true_params
bias_bayes <- colMeans(bayes_estimates, na.rm = TRUE) - true_params

mse_mle <- colMeans((mle_estimates - matrix(true_params, n_sim, 3, byrow = TRUE))^2, na.rm = TRUE)
mse_bayes <- colMeans((bayes_estimates - matrix(true_params, n_sim, 3, byrow = TRUE))^2, na.rm = TRUE)

results <- data.frame(
  Method = rep(c("MLE", "Bayes"), each = 3),
  Parameter = rep(c("a", "b", "p"), 2),
  Bias = c(bias_mle, bias_bayes),
  MSE = c(mse_mle, mse_bayes)
)

print(results)

```

### Plot the estimations
```{r}
df_mle <- as.data.frame(mle_estimates)
df_mle$Method <- "MLE"

df_bayes <- as.data.frame(bayes_estimates)
df_bayes$Method <- "Bayes"

df_all <- rbind(df_mle, df_bayes)
colnames(df_all)[1:3] <- c("a", "b", "p")

df_long <- melt(df_all, id.vars = "Method")

ggplot(df_long, aes(x = value, fill = Method)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~variable, scales = "free", ncol = 1) +
  theme_minimal() +
  labs(title = "Estimated Parameters: MLE vs Bayesian")

```

